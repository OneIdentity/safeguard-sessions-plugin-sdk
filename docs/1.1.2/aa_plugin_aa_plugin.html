
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.5. AAPlugin &#8212; Safeguard for Privileged Sessions Plugin SDK 1.1.2 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Plugin-sdk services" href="services.html" />
    <link rel="prev" title="3.4. Connection information" href="aa_plugin_connection_information.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="services.html" title="4. Plugin-sdk services"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="aa_plugin_connection_information.html" title="3.4. Connection information"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Safeguard for Privileged Sessions Plugin SDK 1.1.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="aa_plugins.html" accesskey="U">3. AA plugin development</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-safeguard.sessions.plugin.aa_plugin">
<span id="aaplugin"></span><h1>3.5. AAPlugin<a class="headerlink" href="#module-safeguard.sessions.plugin.aa_plugin" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-safeguard.sessions.plugin.aa_plugin"></span><div class="section" id="aaplugin-way-of-working">
<h2>3.5.1. AAPlugin way of working<a class="headerlink" href="#aaplugin-way-of-working" title="Permalink to this headline">¶</a></h2>
<p>When SPS calls the AAPlugin, it does so by creating an AAPlugin (or more likely derived class) instance. The
initialization of the instance processes the given plugin configuration and sets the logging level appropriately.</p>
<p>On the new AAPlugin instance SPS will make a call to <code class="docutils literal"><span class="pre">authenticate</span></code>, <code class="docutils literal"><span class="pre">authorize</span></code> or <code class="docutils literal"><span class="pre">session_ended</span></code>. In all cases
AAPlugin first collects the input parameters in
<a class="reference internal" href="aa_plugin_connection_information.html#safeguard.sessions.plugin.connection_info.ConnectionInfo" title="safeguard.sessions.plugin.connection_info.ConnectionInfo"><code class="xref py py-class docutils literal"><span class="pre">self.connection</span></code></a> and sets up
<a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.cookie</span></code></a> and <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.session_cookie</span></code></a> attributes.</p>
<p>In case of <code class="docutils literal"><span class="pre">authenticate</span></code> the prescribed steps in <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps"><code class="xref py py-meth docutils literal"><span class="pre">AAPlugin._authentication_steps()</span></code></a> are executed and if
that was successful then the steps in <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._post_successful_authentication_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._post_successful_authentication_steps"><code class="xref py py-meth docutils literal"><span class="pre">AAPlugin._post_successful_authentication_steps()</span></code></a> are also executed.
The later steps can ask further questions from the user and do other housekeeping tasks.</p>
<p>In case of <code class="docutils literal"><span class="pre">authorize</span></code> the prescribed steps in <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._authorization_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._authorization_steps"><code class="xref py py-meth docutils literal"><span class="pre">AAPlugin._authorization_steps()</span></code></a> are executed, where the last
step is to call <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize"><code class="xref py py-meth docutils literal"><span class="pre">AAPlugin.do_authorize()</span></code></a>.</p>
<p>In case of <code class="docutils literal"><span class="pre">session_ended</span></code> the prescribed steps in <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._session_ended_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._session_ended_steps"><code class="xref py py-meth docutils literal"><span class="pre">AAPlugin._session_ended_steps()</span></code></a> are executed, where the last
step is to call <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended"><code class="xref py py-meth docutils literal"><span class="pre">AAPlugin.do_session_ended()</span></code></a>.</p>
<p>If a step returns with a verdict such as accept, deny or need info, then AAPlugin will add values stored in
<a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.cookie</span></code></a> and <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.session_cookie</span></code></a> to the verdict
and return the result to SPS.</p>
<p>If a step returns with None, then AAPlugin marks it as done, and does not call it again in case the plugin returns
need info and the plugin is invoked again with the same callback.</p>
</div>
<div class="section" id="aaplugin-methods-and-attributes">
<h2>3.5.2. AAPlugin methods and attributes<a class="headerlink" href="#aaplugin-methods-and-attributes" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin">
<em class="property">class </em><code class="descclassname">safeguard.sessions.plugin.aa_plugin.</code><code class="descname">AAPlugin</code><span class="sig-paren">(</span><em>configuration</em>, <em>defaults=None</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin" title="safeguard.sessions.plugin.aa_plugin.AAPlugin"><code class="xref py py-class docutils literal"><span class="pre">AAPlugin</span></code></a> class implements the common functionality of AA plugins.</p>
<dl class="attribute">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie">
<code class="descname">cookie</code><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.cookie</span></code></a> attribute is a dict that retains its contents between invocations of
<a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal"><span class="pre">do_authenticate()</span></code></a>, <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize"><code class="xref py py-meth docutils literal"><span class="pre">do_authorize()</span></code></a> and <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended"><code class="xref py py-meth docutils literal"><span class="pre">do_session_ended()</span></code></a>.
This is the way to pass data between these functions.</p>
<p>When the plugin returns the contents are automatically returned to SPS. Note that when
<a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.with_cookie" title="safeguard.sessions.plugin.plugin_response.AAResponse.with_cookie"><code class="xref py py-meth docutils literal"><span class="pre">AAResponse.with_cookie</span></code></a> is used, it
takes precedence and updates <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.cookie</span></code></a> before returning to SPS.</p>
</dd></dl>

<dl class="attribute">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie">
<code class="descname">session_cookie</code><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.session_cookie</span></code></a> is similar to <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.cookie</span></code></a>, but it is
also visible in other plugins in the same session. When the plugin returns the contents are automatically
returned to SPS. Note that when <a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.with_session_cookie" title="safeguard.sessions.plugin.plugin_response.AAResponse.with_session_cookie"><code class="xref py py-meth docutils literal"><span class="pre">AAResponse.with_session_cookie</span></code></a> is used, it takes precedence and
updates <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie"><code class="xref py py-attr docutils literal"><span class="pre">self.session_cookie</span></code></a> before returning to SPS.</p>
</dd></dl>

<dl class="attribute">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.username">
<code class="descname">username</code><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.username" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.username"><code class="xref py py-attr docutils literal"><span class="pre">self.username</span></code></a> is a
<a class="reference internal" href="plugin_base.html#safeguard.sessions.plugin.plugin_base.cookie_property" title="safeguard.sessions.plugin.plugin_base.cookie_property"><code class="xref py py-meth docutils literal"><span class="pre">&#64;cookie_property</span></code></a> which is equal to the gateway
user name, or if not present, then the target user name, or finally the <code class="docutils literal"><span class="pre">username</span></code> value in the
<code class="docutils literal"><span class="pre">key_value_pairs</span></code>. If none of these are present then the connection is automatically denied as we don’t have
a user name to work with.</p>
<p>The initial value of <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.username"><code class="xref py py-attr docutils literal"><span class="pre">self.username</span></code></a> is calculated by <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_username"><code class="xref py py-meth docutils literal"><span class="pre">_extract_username()</span></code></a>. As a
cookie property, the value of <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.username"><code class="xref py py-attr docutils literal"><span class="pre">self.username</span></code></a> is retained in subsequent invocations of the
plugin.</p>
</dd></dl>

<dl class="attribute">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity">
<code class="descname">mfa_identity</code><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity" title="Permalink to this definition">¶</a></dt>
<dd><p>The <code class="xref py py-attr docutils literal"><span class="pre">self.mfa_identity</span></code> is a
<a class="reference internal" href="plugin_base.html#safeguard.sessions.plugin.plugin_base.cookie_property" title="safeguard.sessions.plugin.plugin_base.cookie_property"><code class="xref py py-meth docutils literal"><span class="pre">&#64;cookie_property</span></code></a> which is equal to
<a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.username"><code class="xref py py-attr docutils literal"><span class="pre">self.username</span></code></a> after mapping and transformations to the multi factor authentication
identity.</p>
<p>As a cookie property, the value of <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity"><code class="xref py py-attr docutils literal"><span class="pre">self.mfa_identity</span></code></a> is retained in subsequent
invocations of the plugin.</p>
</dd></dl>

<dl class="attribute">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_password">
<code class="descname">mfa_password</code><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_password" title="Permalink to this definition">¶</a></dt>
<dd><p>The <code class="xref py py-attr docutils literal"><span class="pre">self.mfa_password</span></code> is read-only property that is implemented by <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password"><code class="xref py py-meth docutils literal"><span class="pre">_extract_mfa_password()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate">
<code class="descname">do_authenticate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal"><span class="pre">do_authenticate()</span></code></a> method should verify that the given MFA identity (<code class="docutils literal"><span class="pre">self.mfa_identity</span></code>) matches the
given MFA password (<code class="docutils literal"><span class="pre">self.mfa_password</span></code>). In case the password is an empty string, the check should do a
challenge-response or push notification or some other check. For details consult the <em>Creating custom
Authentication and Authorization plugins</em> technical document.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dict with at least the key ‘verdict’ to indicate ‘ACCEPT’, ‘DENY’ or ‘NEEDINFO’</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize">
<code class="descname">do_authorize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize"><code class="xref py py-meth docutils literal"><span class="pre">do_authorize()</span></code></a> method should verify that the given MFA identity (<code class="docutils literal"><span class="pre">self.mfa_identity</span></code>)
has authority (has the right) to access the given target asset (<code class="docutils literal"><span class="pre">self.connection.target_user</span></code>,
<code class="docutils literal"><span class="pre">self.connection.target_server</span></code>, etc). For details consult the <em>Creating custom Authentication and
Authorization plugins</em> technical document.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dict with at least the key ‘verdict’ to indicate ‘ACCEPT’, ‘DENY’.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended">
<code class="descname">do_session_ended</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended"><code class="xref py py-meth docutils literal"><span class="pre">do_session_ended()</span></code></a> hook can be used to send a log message related to the entire session or close the
ticket related to the session if the plugin interacts with a ticketing system. For details consult the
<em>Creating custom Authentication and Authorization plugins</em> technical document.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps">
<code class="descname">_authentication_steps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps"><code class="xref py py-meth docutils literal"><span class="pre">_authentication_steps()</span></code></a> function returns a list of other functions to be called to execute the
authentication task. The default implementation is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_authentication_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :meth:`_authentication_steps` function returns a list of other functions to be called to execute the</span>
<span class="sd">        authentication task. The default implementation is as follows:</span>

<span class="sd">        .. literalinclude:: ../../src/safeguard/sessions/plugin/aa_plugin.py</span>
<span class="sd">            :pyobject: AAPlugin._authentication_steps</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_username</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_user_list_whitelist</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ldap_group_whitelist</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_authentication_cache</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_username_explicit</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_username_ldap</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_username</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask_mfa_password</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_authenticate</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._post_successful_authentication_steps">
<code class="descname">_post_successful_authentication_steps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._post_successful_authentication_steps" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._post_successful_authentication_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._post_successful_authentication_steps"><code class="xref py py-meth docutils literal"><span class="pre">_post_successful_authentication_steps()</span></code></a> function returns a list of other functions to call be called
after <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._authentication_steps"><code class="xref py py-meth docutils literal"><span class="pre">_authentication_steps()</span></code></a> in case of successful authentication. The functions listed here may only
return <code class="docutils literal"><span class="pre">None</span></code> or a needinfo reply. The default implementation is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_post_successful_authentication_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :meth:`_post_successful_authentication_steps` function returns a list of other functions to call be called</span>
<span class="sd">        after :meth:`_authentication_steps` in case of successful authentication. The functions listed here may only</span>
<span class="sd">        return ``None`` or a needinfo reply. The default implementation is as follows:</span>

<span class="sd">        .. literalinclude:: ../../src/safeguard/sessions/plugin/aa_plugin.py</span>
<span class="sd">            :pyobject: AAPlugin._post_successful_authentication_steps</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_authentication_cache</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask_questions</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._authorization_steps">
<code class="descname">_authorization_steps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._authorization_steps" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._authorization_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._authorization_steps"><code class="xref py py-meth docutils literal"><span class="pre">_authorization_steps()</span></code></a> function returns a list of other functions to call to finish the authentication
task. The default implementation is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_authorization_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :meth:`_authorization_steps` function returns a list of other functions to call to finish the authentication</span>
<span class="sd">        task. The default implementation is as follows:</span>

<span class="sd">        .. literalinclude:: ../../src/safeguard/sessions/plugin/aa_plugin.py</span>
<span class="sd">            :pyobject: AAPlugin._authorization_steps</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_and_increase_client_connection_count</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_authorize</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._session_ended_steps">
<code class="descname">_session_ended_steps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._session_ended_steps" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._session_ended_steps" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._session_ended_steps"><code class="xref py py-meth docutils literal"><span class="pre">_session_ended_steps()</span></code></a> function returns a list of other functions to call to finish the session_ended
task. The functions in the list must return with None. The default implementation is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_session_ended_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :meth:`_session_ended_steps` function returns a list of other functions to call to finish the session_ended</span>
<span class="sd">        task. The functions in the list must return with None. The default implementation is as follows:</span>

<span class="sd">        .. literalinclude:: ../../src/safeguard/sessions/plugin/aa_plugin.py</span>
<span class="sd">            :pyobject: AAPlugin._session_ended_steps</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrease_client_connection_count</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_session_ended</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_username">
<code class="descname">_extract_username</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_username" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_username"><code class="xref py py-meth docutils literal"><span class="pre">_extract_username()</span></code></a> method may be overridden to modify the calculation of the gateway username. For
example to introduce a new key_value_pair that can be the source of the username.</p>
<p>If this method returns None, then AAPlugin automatically denies the connection.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">str or None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_explicit">
<code class="descname">_map_username_explicit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_explicit" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_explicit" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_explicit"><code class="xref py py-meth docutils literal"><span class="pre">_map_username_explicit()</span></code></a> method is implementing the <code class="docutils literal"><span class="pre">[usermapping</span> <span class="pre">source=explicit]</span></code> section in the
configuration. It may alter the value of <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity"><code class="xref py py-attr docutils literal"><span class="pre">self.mfa_identity</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_ldap">
<code class="descname">_map_username_ldap</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_ldap" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_ldap" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._map_username_ldap"><code class="xref py py-meth docutils literal"><span class="pre">_map_username_ldap()</span></code></a> method is implementing the <code class="docutils literal"><span class="pre">[usermapping</span> <span class="pre">source=ldap_server]</span></code> section in the
configuration. It may alter the value of <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity"><code class="xref py py-attr docutils literal"><span class="pre">self.mfa_identity</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._transform_username">
<code class="descname">_transform_username</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._transform_username" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._transform_username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._transform_username"><code class="xref py py-meth docutils literal"><span class="pre">_transform_username()</span></code></a> method is implementing the <code class="docutils literal"><span class="pre">[username_transform]</span></code> section in the
configuration. It may alter the value of <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity"><code class="xref py py-attr docutils literal"><span class="pre">self.mfa_identity</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._check_username">
<code class="descname">_check_username</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._check_username" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._check_username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._check_username"><code class="xref py py-meth docutils literal"><span class="pre">_check_username()</span></code></a> method checks that the plugin received a user identity to work with. It should
return <a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.deny" title="safeguard.sessions.plugin.plugin_response.AAResponse.deny"><code class="xref py py-meth docutils literal"><span class="pre">AAResponse.deny</span></code></a> verdict if there
is no username, otherwise None.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password">
<code class="descname">_extract_mfa_password</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password"><code class="xref py py-meth docutils literal"><span class="pre">_extract_mfa_password()</span></code></a> method returns the value of <code class="docutils literal"><span class="pre">self.connection.key_value_pairs['otp']</span></code>. The
value is either specified as part of the user name or if not, then AAPlugin will ask the user for it
interactively.</p>
<p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password" title="safeguard.sessions.plugin.aa_plugin.AAPlugin._extract_mfa_password"><code class="xref py py-meth docutils literal"><span class="pre">_extract_mfa_password()</span></code></a> method may be overwritten to modify the calculation of the MFA password. For
example to introduce a new key_value_pair that can be the source of the password.</p>
<p>If this method returns None, then AAPlugin automatically asks for the password.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">str or None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.authenticate">
<code class="descname">authenticate</code><span class="sig-paren">(</span><em>cookie</em>, <em>session_cookie</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.authenticate" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Should not be modified.</strong></p>
<p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.authenticate"><code class="xref py py-meth docutils literal"><span class="pre">authenticate()</span></code></a> function is called by SPS directly. Should not be modified, see
<a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal"><span class="pre">do_authenticate()</span></code></a> for customization.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.authorize">
<code class="descname">authorize</code><span class="sig-paren">(</span><em>cookie</em>, <em>session_cookie</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.authorize" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Should not be modified.</strong></p>
<p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.authorize" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.authorize"><code class="xref py py-meth docutils literal"><span class="pre">authorize()</span></code></a> function is called by SPS directly. Should not be modified, see
<a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize"><code class="xref py py-meth docutils literal"><span class="pre">do_authorize()</span></code></a> for customization.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_ended">
<code class="descname">session_ended</code><span class="sig-paren">(</span><em>session_id</em>, <em>cookie</em>, <em>session_cookie</em><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_ended" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Should not be modified.</strong></p>
<p>The <a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_ended" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_ended"><code class="xref py py-meth docutils literal"><span class="pre">session_ended()</span></code></a> function is called by SPS directly. Should not be modified, see
<a class="reference internal" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended"><code class="xref py py-meth docutils literal"><span class="pre">do_session_ended()</span></code></a> for customization.</p>
</dd></dl>

<dl class="method">
<dt id="safeguard.sessions.plugin.aa_plugin.AAPlugin._add_gateway_user">
<code class="descname">_add_gateway_user</code><span class="sig-paren">(</span><em>verdict</em><span class="sig-paren">)</span><a class="headerlink" href="#safeguard.sessions.plugin.aa_plugin.AAPlugin._add_gateway_user" title="Permalink to this definition">¶</a></dt>
<dd><p>An ACCEPT verdict should return the username that was actually authenticated as gateway user. This function
will use the actual self.username in the return value, unless already set by do_authenticate.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>verdict</strong> – an ACCEPT verdict</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">updated verdict</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="history.html">1. History of releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin_base.html">2. Plugin base functions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="aa_plugins.html">3. AA plugin development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_common_configuration.html">3.1. Common configuration options</a></li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_development.html">3.2. Plugin development</a></li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_plugin_response.html">3.3. Plugin response</a></li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_connection_information.html">3.4. Connection information</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.5. AAPlugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aaplugin-way-of-working">3.5.1. AAPlugin way of working</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aaplugin-methods-and-attributes">3.5.2. AAPlugin methods and attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="services.html">4. Plugin-sdk services</a></li>
<li class="toctree-l1"><a class="reference internal" href="fakes.html">5. Fake services for testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">6. About us</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#contacting-us">7. Contacting us</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#technical-support-resources">8. Technical support resources</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="aa_plugin_connection_information.html"
                        title="previous chapter">3.4. Connection information</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="services.html"
                        title="next chapter">4. Plugin-sdk services</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="services.html" title="4. Plugin-sdk services"
             >next</a> |</li>
        <li class="right" >
          <a href="aa_plugin_connection_information.html" title="3.4. Connection information"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Safeguard for Privileged Sessions Plugin SDK 1.1.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="aa_plugins.html" >3. AA plugin development</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, One Identity LLC. ALL RIGHTS RESERVED.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>