
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>6.2. Plugin development &#8212; Safeguard for Privileged Sessions Plugin SDK 1.4.2 documentation</title>

    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-4.3.1-dist/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinxbootstrap4.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/sphinxbootstrap4.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.3. Plugin response" href="aa_plugin_plugin_response.html" />
    <link rel="prev" title="6.1. Common configuration options" href="aa_plugin_common_configuration.html" />
    <link rel="stylesheet" href="../../_static/css/oi.css" type="text/css" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-84081903-18"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());

     gtag('config', 'UA-84081903-18');
    </script>
     

  </head><body>
  <nav class="navbar navbar-expand-md  fixed-top navbar-dark bg-dark flex-wrap">
    <button class="navbar-toggler ml-auto py-2" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2">
      &#9776;
    </button>
      <div class="navbar-collapse collapse" id="exCollapsingNavbar2">
           <a class="navbar-brand py-1" href="../../index.html">
                  Safeguard for Privileged Sessions Plugin SDK
          </a>
          <span class="navbar-text navbar-version pb-0 pt-1"><b>1.4.2</b></span>
          <ul class="navbar-nav mr-auto">
          
              <li class="nav-item dropdown d-none d-sm-block" id="navbar-pages">
                  <a class="nav-link dropdown-toggle" data-toggle="dropdown">Pages</a>
                  <ul class="dropdown-menu">
                  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../history.html">1. History of releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../history.html#latest-release">1.1. Latest release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history.html#previous-releases">1.2. Previous releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">2. Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-4-1">2.1. Changes in version 1.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-4-0">2.2. Changes in version 1.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-3-1">2.3. Changes in version 1.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-3-0">2.4. Changes in version 1.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-2-1">2.5. Changes in version 1.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-2-0">2.6. Changes in version 1.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-1-4">2.7. Changes in version 1.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-1-3">2.8. Changes in version 1.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-1-2">2.9. Changes in version 1.1.2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">3. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">4. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#starting-from-a-plugin-skeleton">4.1. Starting from a plugin skeleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#starting-from-scratch">4.2. Starting from scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#preparing-the-python-environment">4.3. Preparing the python environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#using-the-python-environment">4.4. Using the python environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pluginv.html">5. pluginv</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#version-information">5.1. Version information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#snapshot-build">5.2. Snapshot build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#release-build">5.3. Release build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#run-unit-and-integration-tests">5.4. Run unit and integration tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#run-test-scenarios">5.5. Run test scenarios</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../aa_plugins.html">6. AA plugin development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_common_configuration.html">6.1. Common configuration options</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.2. Plugin development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#administrative-tasks">6.2.1. Administrative tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-functionality">6.2.2. Basic functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-defined-attributes-on-self">6.2.3. Pre-defined attributes on self</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asking-the-end-user">6.2.4. Asking the end-user</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-cookies">6.2.5. Using cookies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-gateway-user-and-groups">6.2.6. Setting gateway user and groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-additional-meta-data">6.2.7. Setting additional meta data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#avoiding-costly-calculations">6.2.8. Avoiding costly calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-to-the-constructor">6.2.9. Adding to the constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authentication-cache">6.2.10. Authentication cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#altering-the-steps">6.2.11. Altering the steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_plugin_response.html">6.3. Plugin response</a></li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_connection_information.html">6.4. Connection information</a></li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_aa_plugin.html">6.5. AAPlugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aa_plugin_aa_plugin.html#aaplugin-way-of-working">6.5.1. AAPlugin way of working</a></li>
<li class="toctree-l3"><a class="reference internal" href="aa_plugin_aa_plugin.html#aaplugin-methods-and-attributes">6.5.2. AAPlugin methods and attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mfa_client.html">7. MFA Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credentialstore_plugins.html">8. Credential Store plugin development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_common_configuration.html">8.1. Common configuration options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html">8.2. Plugin development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#administrative-tasks">8.2.1. Administrative tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#basic-functionality">8.2.2. Basic functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#pre-defined-attributes-on-self">8.2.3. Pre-defined attributes on self</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#adding-to-the-constructor">8.2.4. Adding to the constructor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_credentialstore_plugin.html">8.3. CredentialStorePlugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_credentialstore_plugin.html#credentialstoreplugin-way-of-working">8.3.1. CredentialStorePlugin way of working</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_credentialstore_plugin.html#credentialstoreplugin-methods-and-attributes">8.3.2. CredentialStorePlugin methods and attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services.html">9. Plugin SDK services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../services/service_plugin_configuration.html">9.1. PluginConfiguration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_plugin_configuration.html#module-safeguard.sessions.plugin.plugin_configuration_exceptions">9.1.1. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_logging.html">9.2. Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#configuration-example">9.2.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#configuring-the-logger-service">9.2.2. Configuring the logger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#acquiring-a-logger">9.2.3. Acquiring a logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#usage-example">9.2.4. Usage example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_credential_store.html">9.3. CredentialStore</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_credential_store.html#configuration-example">9.3.1. Configuration example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../services/service_credential_store.html#acquiring-a-credentialstore">9.3.1.1. Acquiring a CredentialStore</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_credential_store.html#module-safeguard.sessions.plugin.credential_store_exceptions">9.3.2. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_ldap_server.html">9.4. LDAPServer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_ldap_server.html#configuration-example">9.4.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_ldap_server.html#acquiring-a-user-attribute">9.4.2. Acquiring a user attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_ldap_server.html#module-safeguard.sessions.plugin.ldap_server_exceptions">9.4.3. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_user_list.html">9.5. UserList</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_user_list.html#configuration-example">9.5.1. Configuration example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../services/service_user_list.html#checking-whether-a-user-name-matches-a-user-list">9.5.1.1. Checking whether a user name matches a User List</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_user_list.html#module-safeguard.sessions.plugin.user_list_exceptions">9.5.2. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_host_resolver.html">9.6. HostResolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_base_exceptions.html">9.7. Base class for exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_requests_tls.html">9.8. Requests TLS Session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_requests_tls.html#configuration-example">9.8.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_requests_tls.html#getting-a-session-object">9.8.2. Getting a Session object</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_memory_cache.html">9.9. MemoryCache</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_memory_cache.html#configuration-example">9.9.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_memory_cache.html#setting-and-getting-values">9.9.2. Setting and getting values</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">10. Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#unit-tests">10.1. Unit tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../testing/fakes.html">10.1.1. Fake services for testing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../testing/fakes/fake_credential_store.html">10.1.1.1. CredentialStore data injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../testing/fakes/fake_ldap_server.html">10.1.1.2. LDAPServer data injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../testing/fakes/fake_user_list.html">10.1.1.3. UserList data injection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#integration-tests">10.2. Integration tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugin_base.html">11. Plugin base functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#cookie-property">11.1. cookie_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#session-cookie-property">11.2. session_cookie_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#lazy-property">11.3. lazy_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#named-cookie-property">11.4. named_cookie_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#pluginbase">11.5. PluginBase</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">12. About us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html#contacting-us">13. Contacting us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html#technical-support-resources">14. Technical support resources</a></li>
</ul>

                  </ul>
              </li>
          </ul>
          <div class="dropdown-divider d-block d-sm-none mb-4"></div>
             
<form class="form-inline" action="../../search.html" method="get">
  <input type="text" name="q" class="form-control" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <!--<div class="row hidden-sm-up">
          <div class="collapse navbar-toggleable-xs container" id="exCollapsingNavbar2">
              <div class="container">
             　　 <a class="navbar-brand" href="../../index.html">
                      Safeguard for Privileged Sessions Plugin SDK
                  </a>
              </div>
              <ul class="nav navbar-nav">
              </ul>
              <div class="dropdown-divider"></div>
              <div class="navbar-text">search<div>
              
<form class="form-inline" action="../../search.html" method="get">
  <input type="text" name="q" class="form-control" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          </div>
      </div>-->
    </nav>
  </div>

    <div class="related d-flex justify-content-between bg-light flex-wrap" role="navigation" aria-label="related navigation">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="../../index.html">Safeguard for Privileged Sessions Plugin SDK 1.4.2 documentation</a></li>
                <li class="breadcrumb-item"><a href="../aa_plugins.html"
                       
                         accesskey="U"
                         class="active"
                       >6. AA plugin development</a></li>
            <li class="breadcrumb-item active">6.2. Plugin development</li>
        </ol>
       <div>
          <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
               <a href="aa_plugin_common_configuration.html" title="Previous Chapter: 6.1. Common configuration options" class="btn btn-primary" role="botton" accesskey="P">
                   &laquo; 6.1. Common c...
               </a>
               <a href="aa_plugin_plugin_response.html" title="Next Chapter: 6.3. Plugin response" class="btn btn-primary" role="botton" accesskey="N">
                   6.3. Plugin response &raquo;
               </a>
           </div>
       </div>
    </div>

  <div class="main container-fluid">
    <div class="row"> 
      <div class="sphinxsidebar d-none d-md-block">
        <div class="sphinxsidebarwrapper">          
            <h4>Table Of Contents</h4>
            
            
              <div class="sidebartoctree">
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../history.html">1. History of releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../history.html#latest-release">1.1. Latest release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history.html#previous-releases">1.2. Previous releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">2. Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-4-1">2.1. Changes in version 1.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-4-0">2.2. Changes in version 1.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-3-1">2.3. Changes in version 1.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-3-0">2.4. Changes in version 1.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-2-1">2.5. Changes in version 1.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-2-0">2.6. Changes in version 1.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-1-4">2.7. Changes in version 1.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-1-3">2.8. Changes in version 1.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#changes-in-version-1-1-2">2.9. Changes in version 1.1.2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">3. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">4. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#starting-from-a-plugin-skeleton">4.1. Starting from a plugin skeleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#starting-from-scratch">4.2. Starting from scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#preparing-the-python-environment">4.3. Preparing the python environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#using-the-python-environment">4.4. Using the python environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pluginv.html">5. pluginv</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#version-information">5.1. Version information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#snapshot-build">5.2. Snapshot build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#release-build">5.3. Release build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#run-unit-and-integration-tests">5.4. Run unit and integration tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pluginv.html#run-test-scenarios">5.5. Run test scenarios</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../aa_plugins.html">6. AA plugin development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_common_configuration.html">6.1. Common configuration options</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.2. Plugin development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#administrative-tasks">6.2.1. Administrative tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-functionality">6.2.2. Basic functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-defined-attributes-on-self">6.2.3. Pre-defined attributes on self</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asking-the-end-user">6.2.4. Asking the end-user</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-cookies">6.2.5. Using cookies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-gateway-user-and-groups">6.2.6. Setting gateway user and groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-additional-meta-data">6.2.7. Setting additional meta data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#avoiding-costly-calculations">6.2.8. Avoiding costly calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-to-the-constructor">6.2.9. Adding to the constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authentication-cache">6.2.10. Authentication cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#altering-the-steps">6.2.11. Altering the steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_plugin_response.html">6.3. Plugin response</a></li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_connection_information.html">6.4. Connection information</a></li>
<li class="toctree-l2"><a class="reference internal" href="aa_plugin_aa_plugin.html">6.5. AAPlugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aa_plugin_aa_plugin.html#aaplugin-way-of-working">6.5.1. AAPlugin way of working</a></li>
<li class="toctree-l3"><a class="reference internal" href="aa_plugin_aa_plugin.html#aaplugin-methods-and-attributes">6.5.2. AAPlugin methods and attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mfa_client.html">7. MFA Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credentialstore_plugins.html">8. Credential Store plugin development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_common_configuration.html">8.1. Common configuration options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html">8.2. Plugin development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#administrative-tasks">8.2.1. Administrative tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#basic-functionality">8.2.2. Basic functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#pre-defined-attributes-on-self">8.2.3. Pre-defined attributes on self</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_development.html#adding-to-the-constructor">8.2.4. Adding to the constructor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_credentialstore_plugin.html">8.3. CredentialStorePlugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_credentialstore_plugin.html#credentialstoreplugin-way-of-working">8.3.1. CredentialStorePlugin way of working</a></li>
<li class="toctree-l3"><a class="reference internal" href="../credentialstore_plugins/credentialstore_plugin_credentialstore_plugin.html#credentialstoreplugin-methods-and-attributes">8.3.2. CredentialStorePlugin methods and attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services.html">9. Plugin SDK services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../services/service_plugin_configuration.html">9.1. PluginConfiguration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_plugin_configuration.html#module-safeguard.sessions.plugin.plugin_configuration_exceptions">9.1.1. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_logging.html">9.2. Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#configuration-example">9.2.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#configuring-the-logger-service">9.2.2. Configuring the logger service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#acquiring-a-logger">9.2.3. Acquiring a logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_logging.html#usage-example">9.2.4. Usage example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_credential_store.html">9.3. CredentialStore</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_credential_store.html#configuration-example">9.3.1. Configuration example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../services/service_credential_store.html#acquiring-a-credentialstore">9.3.1.1. Acquiring a CredentialStore</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_credential_store.html#module-safeguard.sessions.plugin.credential_store_exceptions">9.3.2. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_ldap_server.html">9.4. LDAPServer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_ldap_server.html#configuration-example">9.4.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_ldap_server.html#acquiring-a-user-attribute">9.4.2. Acquiring a user attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_ldap_server.html#module-safeguard.sessions.plugin.ldap_server_exceptions">9.4.3. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_user_list.html">9.5. UserList</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_user_list.html#configuration-example">9.5.1. Configuration example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../services/service_user_list.html#checking-whether-a-user-name-matches-a-user-list">9.5.1.1. Checking whether a user name matches a User List</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_user_list.html#module-safeguard.sessions.plugin.user_list_exceptions">9.5.2. Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_host_resolver.html">9.6. HostResolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_base_exceptions.html">9.7. Base class for exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_requests_tls.html">9.8. Requests TLS Session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_requests_tls.html#configuration-example">9.8.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_requests_tls.html#getting-a-session-object">9.8.2. Getting a Session object</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/service_memory_cache.html">9.9. MemoryCache</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/service_memory_cache.html#configuration-example">9.9.1. Configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/service_memory_cache.html#setting-and-getting-values">9.9.2. Setting and getting values</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">10. Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#unit-tests">10.1. Unit tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../testing/fakes.html">10.1.1. Fake services for testing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../testing/fakes/fake_credential_store.html">10.1.1.1. CredentialStore data injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../testing/fakes/fake_ldap_server.html">10.1.1.2. LDAPServer data injection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../testing/fakes/fake_user_list.html">10.1.1.3. UserList data injection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../testing.html#integration-tests">10.2. Integration tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugin_base.html">11. Plugin base functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#cookie-property">11.1. cookie_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#session-cookie-property">11.2. session_cookie_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#lazy-property">11.3. lazy_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#named-cookie-property">11.4. named_cookie_property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin_base.html#pluginbase">11.5. PluginBase</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">12. About us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html#contacting-us">13. Contacting us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html#technical-support-resources">14. Technical support resources</a></li>
</ul>

              </div>
            
          
  <h4>Previous topic</h4>
  <p class="topless"><a href="aa_plugin_common_configuration.html"
                        title="previous chapter">6.1. Common configuration options</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="aa_plugin_plugin_response.html"
                        title="next chapter">6.3. Plugin response</a></p>
<div id="searchbox" style="display: none">
    <form class="form search" action="../../search.html" method="get">
      <input type="text" name="q" class="form-control" placeholder="Search..." />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>

<script type="text/javascript">$('#searchbox').show(0);</script>
  <ul class="this-page-menu list-unstyled text-right">
    <li><a href="../../_sources/sections/aa_plugins/aa_plugin_development.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div> 

      <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="plugin-development">
<h1>6.2. Plugin development<a class="headerlink" href="#plugin-development" title="Permalink to this headline">¶</a></h1>
<p>Follow the steps in <a class="reference internal" href="../getting_started.html#gettingstarted-label"><span class="std std-ref">Getting started</span></a> to set up the correct Python environment. There are administrative
steps bellow to describe the plugin. After adding some code to the plugin, the directory can be packaged in a ZIP file
and uploaded to SPS.</p>
<div class="section" id="administrative-tasks">
<h2>6.2.1. Administrative tasks<a class="headerlink" href="#administrative-tasks" title="Permalink to this headline">¶</a></h2>
<p>Update the following files with information correct for your plugin:</p>
<p><code class="docutils literal notranslate"><span class="pre">MANIFEST</span></code>: plugin name, descriptions, etc. For details consult the <em>Creating custom Authentication and Authorization
plugins</em> developer’s guide. To determine the api version, see the <a class="reference internal" href="../getting_started.html#gettingstarted-label"><span class="std std-ref">Getting started</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Pipfile</span></code>: describes what additional Python3 PIP packages to package in the eventual plugin and also what packages to
use at development time. Note that the Plugin SDK should <em>not</em> be listed in the [packages] section, as the Plugin SDK
is pre-installed on Safeguard for Privileges Sessions. There are other pre-installed python packages on the system,
consult the developer’s guide for more information.</p>
</div>
<div class="section" id="basic-functionality">
<h2>6.2.2. Basic functionality<a class="headerlink" href="#basic-functionality" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">lib/plugin.py</span></code> file, there is a simple skeleton code. The methods
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAPlugin.do_authenticate</span></code></a>,
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAPlugin.do_authorize</span></code></a> and
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAPlugin.do_session_ended</span></code></a> are called by the
AAPlugin base class after common
functionality is executed and parameters of the plugin invocation are pre-processed. All information about the
connection and pre-processing will be presented as attributes on <code class="docutils literal notranslate"><span class="pre">self</span></code> in these functions.</p>
<p>The expected return values are defined in the technical document <em>Creating custom Authentication and Authorization
plugins</em>. For simplicity one can use <a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse" title="safeguard.sessions.plugin.plugin_response.AAResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">AAResponse</span></code></a> class
to create the return value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env pluginwrapper3</span>

<span class="kn">from</span> <span class="nn">safeguard.sessions.plugin</span> <span class="kn">import</span> <span class="n">AAPlugin</span><span class="p">,</span> <span class="n">AAResponse</span>

<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># To get a configuration value:</span>
        <span class="n">config_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_configuration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">)</span>

        <span class="c1"># To log something:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;This is a debug message&quot;</span><span class="p">)</span>

        <span class="c1"># To access connection information</span>
        <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">session_id</span>

        <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s1">&#39;the reason to accept&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_authorize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s1">&#39;the reason to accept&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_session_ended</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="pre-defined-attributes-on-self">
<h2>6.2.3. Pre-defined attributes on self<a class="headerlink" href="#pre-defined-attributes-on-self" title="Permalink to this headline">¶</a></h2>
<p>On top of attributes defined by <a class="reference internal" href="../plugin_base.html#pluginbase-section-label"><span class="std std-ref">PluginBase</span></a>, such as
<a class="reference internal" href="../plugin_base.html#safeguard.sessions.plugin.plugin_base.PluginBase.plugin_configuration" title="safeguard.sessions.plugin.plugin_base.PluginBase.plugin_configuration"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.plugin_configuration</span></code></a> and
<a class="reference internal" href="../plugin_base.html#safeguard.sessions.plugin.plugin_base.PluginBase.logger" title="safeguard.sessions.plugin.plugin_base.PluginBase.logger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.logger</span></code></a>
the following attributes are available in all the above methods, except where otherwise noted:</p>
<p><a class="reference internal" href="aa_plugin_connection_information.html#safeguard.sessions.plugin.connection_info.ConnectionInfo" title="safeguard.sessions.plugin.connection_info.ConnectionInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">self.connection</span></code></a> which is a read-only object to show
a record of the SPS connection that is being processed. For example to find out the protocol used in the connection,
write <code class="docutils literal notranslate"><span class="pre">self.connection.protocol</span></code>. Note: only ‘session_id’ is available in
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_session_ended"><code class="xref py py-meth docutils literal notranslate"><span class="pre">do_session_ended</span></code></a> method.
Also ‘target’ related values may not be available in
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">do_authenticate</span></code></a>
method due to protocol/environmental reasons.</p>
<p><a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.username"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.username</span></code></a> contains the effective (gateway) user
name for this connection.</p>
<p><a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_identity"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.mfa_identity</span></code></a> contains the identity to be
used when contacting the MFA service.</p>
<p><a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_password" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_password"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.mfa_password</span></code></a> contains the password acquired
from the user to be used in multi factor authentication.
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_password" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.mfa_password"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.mfa_password</span></code></a> may contain empty string to
indicate that the user requires push notification.
Note: only available in <a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">do_authenticate</span></code></a> method.</p>
</div>
<div class="section" id="asking-the-end-user">
<h2>6.2.4. Asking the end-user<a class="headerlink" href="#asking-the-end-user" title="Permalink to this headline">¶</a></h2>
<p>If the plugin needs extra information such as reponse to a challenge question, then the
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAPlugin.do_authenticate</span></code></a>
method should return a value created by
<a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.need_info" title="safeguard.sessions.plugin.plugin_response.AAResponse.need_info"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAResponse.need_info</span></code></a> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env pluginwrapper3</span>

<span class="kn">from</span> <span class="nn">safeguard.sessions.plugin</span> <span class="kn">import</span> <span class="n">AAPlugin</span><span class="p">,</span> <span class="n">AAResponse</span>

<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;magic&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">key_value_pairs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">need_info</span><span class="p">(</span><span class="s2">&quot;What&#39;s the magic word?&quot;</span><span class="p">,</span> <span class="s2">&quot;magic&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">key_value_pairs</span><span class="p">[</span><span class="s1">&#39;magic&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;please&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">deny</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="using-cookies">
<h2>6.2.5. Using cookies<a class="headerlink" href="#using-cookies" title="Permalink to this headline">¶</a></h2>
<p>It is possible to directly read and write <a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.cookie"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.cookie</span></code></a>
dictionary. The contents will be retained between invocations of the plugin.</p>
<p>It is also possible to add a cookie value on the fly when returning with a verdict from
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAPlugin.do_authenticate</span></code></a>
or <a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authorize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAPlugin.do_authorize</span></code></a> by using the
<a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.with_cookie" title="safeguard.sessions.plugin.plugin_response.AAResponse.with_cookie"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAResponse.with_cookie</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env pluginwrapper3</span>

<span class="kn">from</span> <span class="nn">safeguard.sessions.plugin</span> <span class="kn">import</span> <span class="n">AAPlugin</span><span class="p">,</span> <span class="n">AAResponse</span>

<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span><span class="o">.</span><span class="n">with_cookie</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">somekey</span><span class="o">=</span><span class="s1">&#39;somevalue&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>A more sophisticated way is to define attributes with the
<a class="reference internal" href="../plugin_base.html#safeguard.sessions.plugin.plugin_base.cookie_property" title="safeguard.sessions.plugin.plugin_base.cookie_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">&#64;cookie_property</span></code></a> decorator.</p>
<p>The same things apply to <a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.session_cookie"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.session_cookie</span></code></a>.</p>
</div>
<div class="section" id="setting-gateway-user-and-groups">
<h2>6.2.6. Setting gateway user and groups<a class="headerlink" href="#setting-gateway-user-and-groups" title="Permalink to this headline">¶</a></h2>
<p>AAPlugin shall set the gateway user and gateway groups automatically in case
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.username" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.username"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.username</span></code></a> is different from
<a class="reference internal" href="aa_plugin_connection_information.html#safeguard.sessions.plugin.connection_info.ConnectionInfo" title="safeguard.sessions.plugin.connection_info.ConnectionInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">self.connection</span></code></a>.gateway_user. In other words,
if AAPlugin detects that the authenticated user is different from what SPS thinks is the gateway user, then AAPlugin
overwrites the SPS gateway user.</p>
<p>In order to modify the gateway user and groups of the session from
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate" title="safeguard.sessions.plugin.aa_plugin.AAPlugin.do_authenticate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAPlugin.do_authenticate</span></code></a>, use the
<a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.with_gateway_user" title="safeguard.sessions.plugin.plugin_response.AAResponse.with_gateway_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAResponse.with_gateway_user</span></code></a> method.
Using <a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.with_gateway_user" title="safeguard.sessions.plugin.plugin_response.AAResponse.with_gateway_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAResponse.with_gateway_user</span></code></a>
method overwrites the automatic gateway user setting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env pluginwrapper3</span>

<span class="kn">from</span> <span class="nn">safeguard.sessions.plugin</span> <span class="kn">import</span> <span class="n">AAPlugin</span><span class="p">,</span> <span class="n">AAResponse</span>

<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span><span class="o">.</span><span class="n">with_gateway_user</span><span class="p">(</span><span class="s1">&#39;some-user&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-additional-meta-data">
<h2>6.2.7. Setting additional meta data<a class="headerlink" href="#setting-additional-meta-data" title="Permalink to this headline">¶</a></h2>
<p>In order to set the additional meta data which is stored beside the session, use
<a class="reference internal" href="aa_plugin_plugin_response.html#safeguard.sessions.plugin.plugin_response.AAResponse.with_additional_metadata" title="safeguard.sessions.plugin.plugin_response.AAResponse.with_additional_metadata"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AAResponse.with_additional_metadata</span> </code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env pluginwrapper3</span>

<span class="kn">from</span> <span class="nn">safeguard.sessions.plugin</span> <span class="kn">import</span> <span class="n">AAPlugin</span><span class="p">,</span> <span class="n">AAResponse</span>

<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AAResponse</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span><span class="o">.</span><span class="n">with_additional_metadata</span><span class="p">(</span><span class="s1">&#39;my data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="avoiding-costly-calculations">
<h2>6.2.8. Avoiding costly calculations<a class="headerlink" href="#avoiding-costly-calculations" title="Permalink to this headline">¶</a></h2>
<p>To avoid redoing costly calculations or communication with external systems, it is advisable to store results of
such calculations in attributes decorated with
<a class="reference internal" href="../plugin_base.html#safeguard.sessions.plugin.plugin_base.cookie_property" title="safeguard.sessions.plugin.plugin_base.cookie_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">&#64;cookie_property</span></code></a> decorator. This might be necessary if
the plugin returns “need info” to SPS, thus starting a new instance and execution of the plugin when the reply arrives.</p>
</div>
<div class="section" id="adding-to-the-constructor">
<h2>6.2.9. Adding to the constructor<a class="headerlink" href="#adding-to-the-constructor" title="Permalink to this headline">¶</a></h2>
<p>To enhance the class constructor, one may overload the
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin" title="safeguard.sessions.plugin.aa_plugin.AAPlugin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> function
and add new functionality. Do keep the original call to <code class="docutils literal notranslate"><span class="pre">super().__init__</span></code> at the top.
Note that the configuration parameter is the raw string representation of the plugin configuration, which will be
turned into
<a class="reference internal" href="../plugin_base.html#safeguard.sessions.plugin.plugin_base.PluginBase.plugin_configuration" title="safeguard.sessions.plugin.plugin_base.PluginBase.plugin_configuration"><code class="xref py py-attr docutils literal notranslate"><span class="pre">self.plugin_configuration</span></code></a> by the
base class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env pluginwrapper3</span>

<span class="kn">from</span> <span class="nn">safeguard.sessions.plugin</span> <span class="kn">import</span> <span class="n">AAPlugin</span>

<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
        <span class="c1"># your setup code</span>
</pre></div>
</div>
</div>
<div class="section" id="authentication-cache">
<h2>6.2.10. Authentication cache<a class="headerlink" href="#authentication-cache" title="Permalink to this headline">¶</a></h2>
<p>There is an authentication cache implemented, which allows bypassing the multi factor authentication if the client IP
address and gateway username matches the previous login inside a certain time frame. This is inherently unsafe as the
IP address can be spoofed and the attacker only needs to get the gateway password of the user.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[authentication_cache]</span>
<span class="c1">; hard_timeout=90</span>
<span class="c1">; soft_timeout=15</span>
<span class="c1">; reuse_limit=0</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">hard_timeout</span></code> is the maximum number of seconds that the cache is valid for. The <code class="docutils literal notranslate"><span class="pre">soft_timeout</span></code> can be
set to force re-authentication if the user does not reuse the cache quickly enough. And finally reuse limit is the
number of times the cache can be reused. The default for <code class="docutils literal notranslate"><span class="pre">reuse_limit</span></code> is 0, which means that the authentication
cache is turned off. In the example, if reuse limit is for example 10, and the user successfully authenticated with
multi factor authentication, then the next 10 authentication are bypassed in the next 90 seconds, provided that
there is no gap bigger than 15 seconds between them.</p>
</div>
<div class="section" id="altering-the-steps">
<h2>6.2.11. Altering the steps<a class="headerlink" href="#altering-the-steps" title="Permalink to this headline">¶</a></h2>
<p>The calls from SPS will be translated to discrete steps by
<a class="reference internal" href="aa_plugin_aa_plugin.html#safeguard.sessions.plugin.aa_plugin.AAPlugin" title="safeguard.sessions.plugin.aa_plugin.AAPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AAPlugin</span></code></a>. It is possible to alter the list of
steps. For example to add <code class="docutils literal notranslate"><span class="pre">self.mystep</span></code> before <code class="xref py py-meth docutils literal notranslate"><span class="pre">do_authenticate()</span></code>, which is the last step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_authentication_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_authentication_steps</span><span class="p">())</span>
            <span class="n">steps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mystep</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">steps</span>

        <span class="k">def</span> <span class="nf">mystep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>
</pre></div>
</div>
<p>For example to add a step called <code class="docutils literal notranslate"><span class="pre">self.mystep</span></code> before <code class="docutils literal notranslate"><span class="pre">self._transform_username</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">AAPlugin</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_authentication_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_authentication_steps</span><span class="p">())</span>
            <span class="n">steps_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">]</span>
            <span class="n">index_of_transform_username</span> <span class="o">=</span> <span class="n">steps_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_transform_username&#39;</span><span class="p">)</span>
            <span class="n">steps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index_of_transform_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mystep</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">steps</span>

        <span class="k">def</span> <span class="nf">mystep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
      <div class="clearer"></div>
      </div>
    </div>
<footer class="footer d-flex justify-content-between flex-wrap">
    <div class="copyright">
        <div>&copy; Copyright 2019, One Identity LLC. ALL RIGHTS RESERVED.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.2.0 using <a href="https://github.com/myyasuda/sphinxbootstrap4theme">sphinxbootstrap4theme</a> 0.6.0.</div>
    </div>
    <div>
        <a href="#" class="btn btn-primary btn-sm" role="botton">Back to top</a>
    </div>
</footer>
  </body>
</html>